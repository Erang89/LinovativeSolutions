@inherits LayoutComponentBase
@inject IThemeService _themeProvider
@inject IApplicationStateService _state
@inject IStorageService _storage

<MudThemeProvider IsDarkMode="@_themeProvider.IsDarkTheme" DefaultScrollbar="false" />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout>
    
    <MudAppBar Elevation="1" Color="Color.Transparent" Fixed="false">
        <MudIconButton Icon="@Icons.Material.Filled.Home" Color="Color.Inherit" Edge="Edge.Start" />
        <MudText Typo="Typo.button">Linovative</MudText>
        <MudSpacer />
    </MudAppBar>

    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>

@code {
    bool _drawerOpen = true;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }

    CancellationTokenSource _cts = new();

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        _state.OnChange += StateHasChanged;
        var isDarkTheme = await _storage.GetValue<bool>(StorageKeys.DarkTheme);
        await _themeProvider.SetDarkTheme(isDarkTheme);
    }
}